<!DOCTYPE html>
<html>
<head>
  <title>Weather Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Temperature and Humidity (Past & Future 24h)</h1>
  <div style="width: 50vw;">
    <canvas id="comboChart"></canvas>
  </div>
  <script>
    async function fetchData(url) {
      const res = await fetch(url);
      return res.json();
    }

    async function drawComboChart() {
      const forecast = await fetchData('/api/forecast');

      const foreLabels = forecast.map(d => {
        const date = new Date(d.timestamp);
        const day = date.getDate().toString().padStart(2, '0');
        const month = date.toLocaleString('en-US', { month: 'short' });
        let hour = date.getHours();
        const ampm = hour >= 12 ? 'pm' : 'am';
        hour = hour % 12;
        hour = hour === 0 ? 12 : hour; // Convert 0 to 12 for 12-hour format
        const minute = date.getMinutes().toString().padStart(2, '0');
        return `${day}-${month} ${hour}:${minute} ${ampm}`;
      });
      const foreTemps = forecast.map(d => d.temperature);
      const foreHumids = forecast.map(d => d.humidity);

      const datasets = [
        {
          label: 'Temperature - Forecast',
          data: foreTemps,
          borderColor: 'red',
          yAxisID: 'y1',
          fill: false
        },
        {
          label: 'Humidity - Forecast',
          data: foreHumids,
          borderColor: 'blue',
          yAxisID: 'y',
          fill: false
        }
      ];

      const now = new Date();
      const nowISO = now.toISOString().slice(0, 19); // match your label format

      new Chart(document.getElementById('comboChart'), {
        type: 'line',
        data: {
          labels: foreLabels,
          datasets: datasets
        },
        options: {
          responsive: true,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          stacked: false,
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: { display: true, text: 'Humidity (%)' }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: { display: true, text: 'Temperature (Â°F)' },
              grid: { drawOnChartArea: false }
            }
          }
        }
      });
    }
    drawComboChart();
  </script>
</body>
</html> 